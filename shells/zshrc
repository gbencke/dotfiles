#To be added after the Oh-My-Zsh zshrc script

if [ "$EUID" -eq 0 ]
  then xhost + || true
fi

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

export _JAVA_OPTIONS='-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true'

if ! [[ $(which npm) = *"22.19.0"* ]]; then
        nvm install v22.19.0
        nvm alias default v22.19.0
fi

unalias grv 2>/dev/null

export DEFAULT_AVD=Teste
export ANDROID_HOME=~/Android/Sdk
export QT_QPA_PLATFORMTHEME='qt5ct'

export PATH=$PATH:~/.local/bin:/usr/local/lib/libreoffice/program:/home/gbencke/Android/Sdk/tools/bin
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH=$PATH:$ANDROID_HOME/emulator

ZSH_THEME="clean"

alias grep_js='grep -ir --exclude-dir=node_modules  --include \*.js --include \*.jsx --exclude-dir=dist '
alias grep_jsx='grep -ir --exclude-dir=node_modules  --include \*.js --include \*.jsx --exclude-dir=dist '
alias grep_ts='grep -ir --exclude-dir=node_modules  --include \*.ts --exclude-dir=dist '
alias grep_html='grep -ir --exclude-dir=node_modules  --include \*.html --exclude-dir=dist '
alias grep_css='grep -ir --exclude-dir=node_modules  --include \*.css --include \*.scss --exclude-dir=dist '
alias grep_package_json='grep -ir --exclude-dir=000.INFRA --exclude-dir=node_modules  --include=package.json '

alias homebrew='HOMEBREW_NO_AUTO_UPDATE=1 brew install '
alias move_gitea='git remote remove origin; git remote add origin https://gitea.benckesoftware.com.br:3010/gbencke/$(basename $(pwd)).git ; git push origin --all'
alias node_modules_jest='tsc; node --inspect-brk node_modules/jest/bin/jest.js'

alias jt=/opt/jetbrains-toolbox/jetbrains-toolbox
alias vim=nvim 
alias gvim=nvim 

diff_obsidian(){
    set +x
    echo 'Will run diff'
    diff -C 10 /mnt/d/GoogleDrive/Pessoal/gitjournal/assets/00.Daily/$(date '+%Y.%m.%d').md /mnt/d/GoogleDrive/Pessoal/gitjournal/assets/00.Daily/00._Template/CurrentTasks.md
}

remove_husky(){
    sed -i -e 's/hooksPath = .husky//g' .git/config
}

remove_cdkout(){
    find . -type d -name cdk.out -exec rm -rf {} \;  
}

remove_node_modules(){
    find . -type d -name node_modules -exec rm -rf {} \;  
}

search_desktop(){
    # nmap -p3389 "192.168.15.*" -oG -
    nmap 192.168.15.1-15  -p3389   -Pn
}

list_remotes(){
  for a in $(ls -1 ); do
    echo $a
    cd $a
    git remote -v
    cd ..
  done
}

eslint_changes(){
  export FILES_TO_CHECK=$(git diff --name-only  $(git merge-base HEAD master  2> /dev/null || git merge-base HEAD main 2> /dev/null ) | tr '\n' ' ')
  echo $FILES_TO_CHECK
  eval "docker run -it --rm -v $(pwd):/data dockerized-eslint -c /config/eslint.config.ts $FILES_TO_CHECK"
}

flake8_changes(){
  export FILES_TO_CHECK=$(git diff --name-only  $(git merge-base HEAD master  2> /dev/null || git merge-base HEAD main 2> /dev/null ) | tr '\n' ' ')
  echo $FILES_TO_CHECK
  eval "flake8 --select=WPS $FILES_TO_CHECK"
}

changed_files(){
  export BASE_COMMIT=$(git merge-base HEAD master 2> /dev/null || git merge-base HEAD main 2> /dev/null)
  git diff --name-only $BASE_COMMIT | tr '\n' ' '
}

run_code(){
  NODE_OPTIONS= code $PWD
}

yt_download(){
    CDATE=$(date '+%Y%m%d%H%M')
    echo $CDATE
    yt-dlp -f bv+ba/b --restrict-filenames --remux-video mkv --merge-output-format mkv   -o "$CDATE.%(title)s.%(id)s.%(ext)s" $1
}

alias git_changed_files=changed_files
alias git_eslint_changes=eslint_changes
alias removeHusky=remove_husky
alias removeCdkout=remove_cdkout
alias removeNodeModules=remove_node_modules
alias diffObsidian=diff_obsidian
alias listremotes=list_remotes
alias searchdesktop=search_desktop
alias runCode=run_code
alias df=duf --theme dark
alias yt=yt_download

# macOS-specific Android SDK paths
export PATH=$PATH:$HOME/Library/Android/sdk/platform-tools
export PATH=$PATH:$HOME/Library/Android/sdk/tools/bin
export PATH=$PATH:$HOME/Library/Android/sdk/tools
export ANDROID_HOME=$HOME/Library/Android/sdk/

# Haxe configuration
export HAXE_STD_PATH="/opt/homebrew/lib/haxe/std"
export LOCAL_DATETIME=$(date +"%Y-%m-%dT%H:%M:%S%z")

export PYENV_ROOT="$HOME/.pyenv"
command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

# macOS-specific paths
export PATH="/opt/homebrew/opt/ruby/bin:$PATH"
export PATH="/Applications/Docker.app/Contents/Resources/bin:$PATH"
export PATH="/opt/homebrew/opt/openjdk@17/bin:$PATH"
export JAVA_HOME="/opt/homebrew/opt/openjdk@17"
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"
export PATH="$PATH:$HOME/go/bin"
export PATH="$PATH:$HOME/.dotnet/tools"

# Database configuration
export PG_POSTGRESS_PASSWORD_BASE64='<<SECRET>>'
export PG_SU_PASSWORD='<<SECRET>>'
export PG_POSTGRES_PORT=5432
export PYSCRAPPERJOB_DUMP_FILE=20250316170001.dump
export PYSCRAPPERJOB_DUMP_DIR=~/Downloads
export PYSCRAPPERJOB_DUMP=$PYSCRAPPERJOB_DUMP_DIR/$PYSCRAPPERJOB_DUMP_FILE
# export GITHUB_TOKEN=<<SECRET>>

# iTerm2 integration
test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

# Auto git refresh script
FILE=~/.last_git_refresh
OLDTIME=600
CURTIME=$(date +%s)

# Check if file exists before getting modification time
if [ -f "$FILE" ]; then
    FILETIME=$(stat -t %s -f %m "$FILE" 2>/dev/null)
    TIMEDIFF=$(expr $CURTIME - $FILETIME)
else
    # File doesn't exist, assume it's old
    TIMEDIFF=$((OLDTIME + 1))
fi

# Check if file older
if [ $TIMEDIFF -gt $OLDTIME ]; then
   echo "File is older, do stuff here"
   cd ~/gitjournal/
   git add .
   git commit -m $LOCAL_DATETIME
   git push origin --all
   git push oracle --all
   git pull origin master
   git pull oracle master

   cd ~/Desktop/
   git add .
   git commit -m $LOCAL_DATETIME
   git push origin --all
   git pull origin master

   cd ~/git/296.traggo.scripts/
   git add .
   git commit -m $LOCAL_DATETIME
   git push origin --all
   git pull origin master

   cd ~/git/295.DataGrip.Personal.Projects
   git add .
   git commit -m $LOCAL_DATETIME
   git push origin --all
   git pull origin master

   source ~/.cargo/env

   clear
   touch $FILE
   cd
fi

# AI/API Keys
export OPENAI_KEY='<<SECRET>>'
export OPENROUTER_API_KEY='<<SECRET>>'
# export GEMINI_API_KEY='<<SECRET>>'
export AIDER_EDITOR=nvim
export AI_BACKUP_PR_FOLDER=~/Desktop/AI/PRs
# export PR_MODELS_TO_RUN="claude.3.7 anthropic/claude-3.7-sonnet kimi_k2 moonshotai/kimi-k2 qwen3_14b qwen/qwen3-14b:free deepseek deepseek/deepseek-r1-0528:free"
export PR_MODELS_TO_RUN="claude.3.7 anthropic/claude-3.7-sonnet"

# Added by LM Studio CLI (lms)
export PATH="$PATH:$HOME/.lmstudio/bin"
# End of LM Studio CLI section

function _midnight_commander {
    it2profile -s mc;
    LANG=en_EN.UTF-9 mc;
}

# Neovim Configuration Cleaner
# Cleans all XDG-compliant Neovim directories (config, data, cache, state)
nvim-clean() {
  # Leverage current shell's environment
  local xdg_config="${XDG_CONFIG_HOME:-$HOME/.config}"
  local xdg_data="${XDG_DATA_HOME:-$HOME/.local/share}"
  local xdg_cache="${XDG_CACHE_HOME:-$HOME/.cache}"
  local xdg_state="${XDG_STATE_HOME:-$HOME/.local/state}"

  # Neovim directories following XDG spec
  local -A nvim_dirs=(
    [config]="$xdg_config/nvim"
    [data]="$xdg_data/nvim"
    [cache]="$xdg_cache/nvim"
    [state]="$xdg_state/nvim"
  )

  echo "Neovim Configuration Cleaner"
  echo "============================\n"

  # Enumerate targets
  echo "Directories to remove:\n"
  for key value in ${(kv)nvim_dirs}; do
    if [[ -d "$value" ]]; then
      echo "  [$key] $value (EXISTS)"
    else
      echo "  [$key] $value (not found)"
    fi
  done

  echo "\n⚠️  This will:"
  echo "  • Remove all configuration files"
  echo "  • Delete installed plugins"
  echo "  • Clear undo history and state"
  echo "  • Remove cache and compiled files\n"

  # Interactive confirmation
  read -q "REPLY?Proceed? (y/n) "
  echo

  [[ ! $REPLY =~ ^[Yy]$ ]] && { echo "Cancelled."; return 0 }

  # Execute removal
  for key value in ${(kv)nvim_dirs}; do
    [[ -d "$value" ]] && {
      echo "Removing $key: $value"
      rm -rf "$value"
    }
  done

  echo "\n✓ Neovim configuration cleaned"
  echo "Next launch will start fresh"
}

# Arbitrium development environment
export NODE_ENV=development
export ARB_API_DEV=true
export EDITOR=nvim

alias midnight_commander=_midnight_commander
alias nvc='nvim-clean'

source ~/git/000.INFRA/dotfiles/prompts/scripts/prompts.sh
source ~/git/000.INFRA/dotfiles/prompts/scripts/summarize.sh

alias litellm_proxy="litellm --config ~/git/000.INFRA/dotfiles/prompts/tools/litellm/litellm.config.yaml"

# Service API keys
export AWS_REGION=us-east-1
export EXA_KEY_TOKEN='<<SECRET>>'
export GITEA_TOKEN='<<SECRET>>'
export GITEA_ACCESS_TOKEN=$GITEA_TOKEN
export CONTEXT7_API_KEY='<<SECRET>>'
export HF_TOKEN='<<SECRET>>'

export UV_ENV_FILE=.env

cd

